<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset = "utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Restaurant Menu Signup</title>

    <link href = "bootstrap.css" rel = "stylesheet">
  </head>

  <script>

    var WS_url = "webservice.php/";

    // add customer to database
    function addCustomer()
    {

     // Get the fields needed
    var fname = document.getElementById("fname").value;
    var lname = document.getElementById("lname").value;
    var uname = document.getElementById("username").value;
    var pw = document.getElementById("password").value;
    var email = document.getElementById("email").value;

    // check for valid inputs
    if( fname == ""|| fname == null,  lname == "" || lname == null,  uname == ""|| uname == null,  pw == ""|| pw == null,  email == "" || email == null)
    {

    alert("One or more of the required fields is invalid!");
    return;
    
    }
    
    // AJAX Request
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() // callback
    {
    
    // REPLY FROM WEBSERVICE
    if (xhttp.readyState == 4 && xhttp.status == 200){
    
    // receive response to JSON object
    var response = JSON.parse(escapeSpecialChars(xhttp.responseText));

    if(!response.success)
    alert(reponse.message);

    else
    {
   

    // notify user was added
    alert(response.message);

    // send back to login screen
    window.location.href = "login.html";
    }

    }

    };

    // encode multiple parameters into php query url
    var req_url = encodeURIComponent(WS_url + "?method=addCustomer&fname="+fname+"&lname="+lname+"&uname="+uname+"&pw="+pw+"&email="+email);

    // REQUEST TO WEBSERVICE
    xhttp.open("GET", req_url, true);
    xhttp.send();

    }

    // Escapes special characters from response from webservice JSON string so that it works properly with JSON.parse
    // NOTE: this code was taken from http://qnimate.com/json-parse-throws-unexpected-token-error-for-valid-json/
    function escapeSpecialChars(jsonString) {

            return jsonString.replace(/\n/g, "\\n")
                .replace(/\r/g, "\\r")
                .replace(/\t/g, "\\t")
                .replace(/\f/g, "\\f");

        }

  </script>


  <body>
    <header class = "container">
      <h1>Good Earth Menu</h1>
    </header>

    <div class = "col-lg-4">
      <h3> Registration</h3> <br>

      <!-- registration form -->
      First name: <input type = "text" id = "fname"><br> <br>
      Last name: <input type = "text" id = "lname"><br> <br>
      Username: <input type = "text" id = "username"><br> <br>
      Password: <input type = "password" id = "password"><br> <br>
      Email: <input type = "text" id = "email"><br><br>

      <!-- TODO: submit account to database on click -->
      <input type = "submit" value = "Register!" onclick = "addCustomer()"> 

    </div>

  </body>

</html>
